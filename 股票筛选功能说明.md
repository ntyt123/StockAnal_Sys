# 🎯 股票筛选功能说明

## 📋 功能概述

现在点击"开始筛选"按钮时，系统会从数据库中获取真实的A股基础信息进行筛选，而不是使用模拟数据。这确保了筛选结果的真实性和准确性。

## 🔄 工作流程

### 1. 数据获取
- 系统从SQLite数据库的 `stock_info` 表中获取A股基础信息
- 支持按市场类型、行业等条件进行初步筛选
- 默认获取最多1000只股票（可通过API参数调整）

### 2. 筛选处理
- **基础筛选**：市场类型、行业（在数据库层面处理）
- **技术指标筛选**：RSI、MACD、成交量等（目前使用模拟数据）
- **基本面筛选**：PE、PB、ROE等（目前使用模拟数据）

### 3. 结果展示
- 显示筛选后的股票列表
- 包含股票代码、名称、行业、价格、涨跌幅、评分等信息
- 支持查看详情和添加到自选股

## 🛠️ API端点

### 获取股票列表
```
GET /api/stocks
```

**参数：**
- `market_type`: 市场类型（默认：A股）
- `industry`: 行业筛选（可选）
- `limit`: 返回数量限制（默认：1000）

**示例：**
```bash
# 获取所有A股
GET /api/stocks?market_type=A&limit=100

# 获取银行行业股票
GET /api/stocks?market_type=A&industry=银行&limit=50
```

### 股票下载状态
```
GET /api/stock_download_status
```

**返回：**
- `stock_count`: 数据库中的股票数量
- `is_downloading`: 是否正在下载
- `has_data`: 是否有数据
- `last_update`: 最后更新时间

### 手动下载股票数据
```
POST /api/download_stock_info
```

**功能：**
- 手动触发股票数据下载
- 防止重复下载
- 后台异步执行

### 强制获取新数据
```
POST /api/download_stock_info
```

**功能：**
- 强制覆盖现有数据，获取最新股票信息
- 显示实时进度条和状态更新
- 支持进度监控和完成通知

## 📊 数据说明

### 真实数据（来自数据库）
- **股票代码**：完整的A股代码
- **股票名称**：官方股票名称
- **所属行业**：股票所属行业分类
- **市场类型**：A股、港股、美股等
- **更新时间**：数据最后更新时间

### 模拟数据（技术指标）
- **价格**：模拟的当前价格
- **涨跌幅**：模拟的涨跌幅度
- **评分**：模拟的综合评分
- **技术指标**：RSI、MACD、KDJ等

## 🎨 界面特性

### 数据状态显示
- **绿色**：有数据，显示股票数量
- **黄色**：无数据，显示下载按钮
- **蓝色**：正在下载中
- **红色**：错误状态

### 筛选结果表格
- 实时显示筛选结果数量
- 数据来源说明提示（包含数据获取时间）
- 支持导出功能
- 每行股票都有操作按钮

### 数据管理工具
- **强制获取新数据**：覆盖现有数据，获取最新信息
- **实时进度条**：显示数据获取进度和状态
- **智能状态监控**：自动检测下载完成状态
- **时间戳显示**：实时显示数据最后更新时间

## 🔧 使用方法

### 1. 启动系统
```bash
# 使用集成启动脚本（推荐）
./start_web_server.sh

# 或直接运行
python web_server.py
```

### 2. 等待数据下载
- 首次启动会自动检查并下载股票数据
- 查看页面顶部的数据状态指示器
- 如果没有数据，点击"下载股票数据"按钮
- 如需强制更新数据，点击"强制获取新数据"按钮

### 3. 进行筛选
- 选择市场类型（A股、港股、美股）
- 选择行业板块（可选）
- 设置技术指标筛选条件
- 点击"开始筛选"按钮

### 4. 查看结果
- 筛选结果会显示在表格中
- 点击"查看详情"查看股票详细信息
- 点击"添加到自选股"收藏股票

## 🧪 测试验证

### 运行测试脚本
```bash
python test_stock_api.py
```

### 手动测试
1. 启动Web服务器
2. 访问 `http://localhost:8888/select_stock`
3. 检查数据状态
4. 进行筛选操作
5. 验证结果

## 📝 注意事项

### 数据依赖
- 筛选功能依赖数据库中的股票基础信息
- 首次使用需要等待数据下载完成
- 技术指标数据目前为模拟数据

### 性能考虑
- 数据库查询已优化，支持大量数据
- 筛选结果限制在1000只以内
- 异步下载不影响筛选性能

### 错误处理
- 网络错误时显示友好提示
- 数据库错误时记录详细日志
- 筛选失败时提供重试选项

## 🚀 未来改进

### 短期计划
- 集成真实的技术指标数据API
- 添加更多筛选条件（市值、流通股本等）
- 优化筛选算法性能

### 长期计划
- 支持自定义筛选策略
- 添加筛选结果排序功能
- 集成机器学习推荐算法

---

**提示**：如果遇到问题，请检查数据库状态和网络连接，查看浏览器控制台的错误信息。
